创世区块作为第零个区块，其他区块直接或间接引用到创世区块。因此节点启动之初必须载入正确的创世区块信息，且不得任意修改。

以太坊允许通过创世配置文件来初始化创世区块，也可使用选择使用内置的多个网络环境的创世配置。默认使用以太坊主网创世配置。

JSON 格式的创世配置：略

根据配置用途可分为三大类：

* 链配置

  * config项是定义链配置，会影响共识协议，虽然链配置对创世影响不大，但新区块的出块规则均依赖链配置。

* 创世区块头信息配置

  * nonce：随机数，对应创世区块 Nonce 字段。

  * timestamp：UTC时间戳，对应创世区块 Time字段。

  * extraData：额外数据，对应创世区块 Extra 字段。

  * gasLimit：必填，燃料上限，对应创世区块 GasLimit 字段。

  * difficulty：必填，难度系数，对应创世区块 Difficulty 字段。搭建私有链时，需要根据情况选择合适的难度值，以便调整出块。

  * minHash：一个哈希值，对应创世区块的MixDigest字段。和 nonce 值一起证明在区块上已经进行了足够的计算。

  * coinbase：一个地址，对应创世区块的Coinbase字段。

* 初始账户资产配置

  * alloc 项是创世中初始账户资产配置。在生成创世区块时，将此数据集中的账户资产写入区块中，相当于预挖矿。这对开发测试和私有链非常好用，不需要挖矿就可以直接为任意多个账户分配资产。

geth 运行的默认配置

```
// DefaultGenesisBlock returns the Ethereum main net genesis block.
func DefaultGenesisBlock() *Genesis{}
```

**geth 创世区块加载流程**

![](/assets/gession-load-process.png)

**加载创世配置**

![](/assets/gession-load-configuration.png)

**安装创世区块**

![](/assets/install-genission-block.png)

首先，需要从数据库中根据区块高度 0 读取创世区块哈希。如果不存在则说明本地属于第一次启动，直接使用运行时创世配置来构建创世区块。属于首次，还需要存储创世区块和链配置。

如果存在，则需要使用运行时创世配置构建创世区块并和本次已存储的创世区块哈希进行对比。一旦不一致，则返回错误，不得继续。

随后，还需要检查链配置。先从数据库获取链配置，如果不存在，则无需校验直接使用运行时链配置。否则，需要检查运行时链配置是否正确，只有正确时才能替换更新。但有一个例外：主网配置不得随意更改，由代码控制而非人为指定。

**构建创建区块**

```
func (g *Genesis) ToBlock(db ethdb.Database) *types.Block{ }
```

细节:

* 创世区块无父块，从零初始化全新的 state
* 遍历配置中 Alloc 项账户集合数据，直接写入 state 中。
* 将账户数据写入 state 后，便可以计算出 state 数据的默克尔树的根值，称之为 StateRoot。
  此值记录在区块头 Root 字段中。
* 创世配置的一部分配置，则直接映射到区块头中，完成创世区块头的构建。
* 因为 GasLimit 和 Difficulty 直接影响到下一个区块出块处理。
* 提交 state，将 state 数据提交到底层的内存 trie 数据中。
* 将内存 trie 数据更新到 db 中。这是多余的一步，因为提交到数据库是由外部进行，这里只需要负责生成区块。
* 利用区块头创建区块，且区块中无交易记录。



